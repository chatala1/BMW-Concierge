---
layout: default
title: "Smartcar OAuth Callback"
description: "Smartcar API OAuth callback endpoint for BMW Concierge"
---

<div class="callback-container">
    <div class="callback-card">
        <div class="callback-header">
            <i data-lucide="car" class="icon" style="color: var(--bmw-blue);"></i>
            <h1>Smartcar Authentication</h1>
            <p>Processing your vehicle connection...</p>
        </div>

        <div id="callback-status" class="callback-status">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p>Connecting to your vehicle...</p>
            </div>
        </div>

        <div id="callback-success" class="callback-result" style="display: none;">
            <i data-lucide="check-circle" class="icon" style="color: #28a745;"></i>
            <h2 style="color: #28a745;">Vehicle Connected Successfully!</h2>
            <p>Your vehicle has been successfully connected to BMW Concierge via Smartcar.</p>
            
            <div class="callback-actions">
                <a href="{{ '/' | relative_url }}" class="btn btn-outline">Back to Home</a>
                <a href="{{ '/protected.html' | relative_url }}" class="btn btn-primary">Go to Dashboard</a>
            </div>
        </div>

        <div id="callback-error" class="callback-result" style="display: none;">
            <div class="error-icon" style="color: #dc3545; font-size: 3rem; margin-bottom: 1rem;">
                <i data-lucide="alert-circle" class="icon"></i>
                <span class="icon-fallback" style="display: none;">‚ö†Ô∏è</span>
            </div>
            <h2 style="color: #dc3545;">Connection Failed</h2>
            <p id="error-message">There was an issue connecting your vehicle. Please try again.</p>
            
            <div class="callback-actions">
                <button onclick="retryConnection()" class="btn btn-primary">Try Again</button>
                <a href="{{ '/' | relative_url }}" class="btn btn-outline">Back to Home</a>
            </div>
        </div>

        <div id="callback-demo" class="callback-result" style="display: none;">
            <div class="demo-icon" style="color: var(--bmw-blue); font-size: 3rem; margin-bottom: 1rem;">
                <i data-lucide="play-circle" class="icon"></i>
                <span class="icon-fallback" style="display: none;">üéØ</span>
            </div>
            <h2 style="color: var(--bmw-blue);">Demo Mode</h2>
            <p>BMW Concierge is running in demo mode. Smartcar integration requires configuration with valid API credentials.</p>
            
            <div style="background: #e7f3ff; border: 1px solid #b3d7ff; border-radius: 4px; padding: 1rem; margin: 1.5rem 0; text-align: left;">
                <h3 style="margin-top: 0; color: var(--bmw-blue); font-size: 1rem;">For Developers:</h3>
                <p style="margin: 0.5rem 0; font-size: 0.9rem;">To enable real Smartcar integration:</p>
                <ol style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem;">
                    <li>Sign up for a Smartcar developer account</li>
                    <li>Configure your client ID in the application</li>
                    <li>Set the redirect URI to: <code style="background: #f8f9fa; padding: 0.2rem;">{{ site.url }}{{ site.baseurl }}/smartcar/callback</code></li>
                </ol>
            </div>
            
            <div class="callback-actions">
                <button onclick="simulateDemoConnection()" class="btn btn-primary">Try Demo Connection</button>
                <a href="{{ '/protected.html' | relative_url }}" class="btn btn-outline">Go to Dashboard</a>
                <a href="{{ '/' | relative_url }}" class="btn btn-outline">Back to Home</a>
            </div>
        </div>
    </div>
</div>

<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <h2>About Smartcar Integration</h2>
    <p>BMW Concierge uses Smartcar's secure API to connect with your vehicle. This integration allows you to:</p>
    
    <ul style="margin: 1rem 0 1rem 1.5rem;">
        <li><strong>Vehicle Status:</strong> Access real-time battery, fuel, and odometer data</li>
        <li><strong>Location Services:</strong> View your vehicle's current location</li>
        <li><strong>Remote Controls:</strong> Lock/unlock doors and control climate</li>
        <li><strong>Security:</strong> Industry-standard OAuth 2.0 authentication</li>
    </ul>

    <div style="background: #f8f9fa; padding: 1.5rem; margin-top: 1.5rem;">
        <h3 style="margin-bottom: 1rem;">Privacy & Security:</h3>
        <ul style="margin-left: 1.5rem;">
            <li>Your vehicle data is securely transmitted via Smartcar's encrypted API</li>
            <li>BMW Concierge only accesses data necessary for the dashboard features</li>
            <li>You can revoke access at any time through your vehicle's connected services</li>
            <li>No sensitive personal data is stored locally</li>
        </ul>
        
        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--bmw-gray);">
            <strong>Note:</strong> This integration requires a compatible vehicle with Smartcar support.
        </p>
    </div>
</div>

<script>
// Smartcar OAuth callback handling
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Smartcar callback processing
    setTimeout(function() {
        if (window.bmwAuth) {
            window.bmwAuth.handleSmartcarCallback();
        } else {
            showCallbackError('Authentication system not available');
        }
    }, 100); // Small delay to ensure all scripts are loaded
});

function retryConnection() {
    // Reset the UI and retry the connection
    document.getElementById('callback-status').style.display = 'block';
    document.getElementById('callback-success').style.display = 'none';
    document.getElementById('callback-error').style.display = 'none';
    document.getElementById('callback-demo').style.display = 'none';
    
    if (window.bmwAuth) {
        window.bmwAuth.handleSmartcarCallback();
    } else {
        showCallbackError('Authentication system not available');
    }
}

function showCallbackSuccess() {
    document.getElementById('callback-status').style.display = 'none';
    document.getElementById('callback-success').style.display = 'block';
    document.getElementById('callback-error').style.display = 'none';
    document.getElementById('callback-demo').style.display = 'none';
}

function showCallbackDemoMode() {
    document.getElementById('callback-status').style.display = 'none';
    document.getElementById('callback-success').style.display = 'none';
    document.getElementById('callback-error').style.display = 'none';
    document.getElementById('callback-demo').style.display = 'block';
    
    // Initialize Lucide icons for the new content
    if (typeof lucide !== 'undefined') {
        bmwIcons.createIcons();
    } else {
        // Show fallback icons if Lucide is not available
        setTimeout(() => {
            const lucideIcon = document.querySelector('#callback-demo i[data-lucide]');
            const fallbackIcon = document.querySelector('#callback-demo .icon-fallback');
            
            if (lucideIcon && fallbackIcon) {
                if (!lucideIcon.querySelector('svg') && typeof lucide === 'undefined') {
                    lucideIcon.style.display = 'none';
                    fallbackIcon.style.display = 'inline-block';
                }
            }
        }, 100);
    }
}

function showCallbackError(message) {
    document.getElementById('callback-status').style.display = 'none';
    document.getElementById('callback-success').style.display = 'none';
    document.getElementById('callback-error').style.display = 'block';
    document.getElementById('callback-demo').style.display = 'none';
    
    if (message) {
        document.getElementById('error-message').textContent = message;
    }
    
    // Show fallback icon if Lucide is not available
    setTimeout(() => {
        const lucideIcon = document.querySelector('#callback-error i[data-lucide]');
        const fallbackIcon = document.querySelector('#callback-error .icon-fallback');
        
        if (lucideIcon && fallbackIcon) {
            // Check if Lucide icon was rendered (has children or specific attributes)
            if (!lucideIcon.querySelector('svg') && typeof lucide === 'undefined') {
                lucideIcon.style.display = 'none';
                fallbackIcon.style.display = 'inline-block';
            }
        }
    }, 100);
}

function simulateDemoConnection() {
    // Show loading state
    showCallbackStatus();
    
    // Simulate demo connection after delay
    setTimeout(function() {
        if (window.bmwAuth) {
            window.bmwAuth.simulateSmartcarConnection('demo_code');
        } else {
            showCallbackSuccess();
        }
    }, 2000);
}

function showCallbackStatus() {
    document.getElementById('callback-status').style.display = 'block';
    document.getElementById('callback-success').style.display = 'none';
    document.getElementById('callback-error').style.display = 'none';
    document.getElementById('callback-demo').style.display = 'none';
}
</script>

<style>
.callback-container {
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 1rem;
}

.callback-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 3rem 2rem;
    text-align: center;
    max-width: 500px;
    width: 100%;
}

.callback-header {
    margin-bottom: 2rem;
}

.callback-header .icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.callback-status {
    margin: 2rem 0;
}

.loading-spinner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
}

.spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid var(--bmw-blue);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.callback-result {
    margin: 2rem 0;
}

.callback-result .icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.callback-actions {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

@media (max-width: 480px) {
    .callback-card {
        padding: 2rem 1rem;
    }
    
    .callback-actions {
        flex-direction: column;
    }
}
</style>