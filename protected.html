---
layout: default
title: "Dashboard"
description: "BMW Concierge Dashboard - Your personalized vehicle management center"
---

<div class="hero" style="background: linear-gradient(135deg, #28a745, #20c997);">
    <h1>BMW Concierge Dashboard</h1>
    <p>Your personalized vehicle management center</p>
</div>

<div class="protected-content">
    <!-- Content will be dynamically updated by auth.js based on authentication status -->
    <h3>Authentication Required</h3>
    <p>Please log in with your GitHub account to access this content.</p>
    <button onclick="bmwAuth.login()" class="btn btn-primary mt-lg">
        Login with GitHub
    </button>
</div>

<div class="auth-required">
    <div class="features-grid">
        <div class="feature-card">
            <i data-lucide="bmw-car" class="icon"></i>
            <h3>Vehicle Status</h3>
            <div id="api-mode-indicator" class="api-mode-indicator" style="margin-bottom: 1rem;">
                <!-- Will be populated by JavaScript -->
            </div>
            <div id="vehicle-status-data" style="text-align: left; margin-top: 1rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Battery Level:</span>
                    <span id="battery-level" style="color: #28a745; font-weight: 600;">Loading...</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Fuel Level:</span>
                    <span id="fuel-level" style="color: #28a745; font-weight: 600;">Loading...</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Range:</span>
                    <span id="vehicle-range" style="color: var(--bmw-blue); font-weight: 600;">Loading...</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Doors:</span>
                    <span id="door-status" style="color: #28a745; font-weight: 600;">Loading...</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Vehicle Status:</span>
                    <span id="vehicle-status" style="color: #28a745; font-weight: 600;">Loading...</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Last Updated:</span>
                    <span id="last-updated" style="color: var(--bmw-gray);">Loading...</span>
                </div>
                <div id="data-source-info" style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--bmw-gray);">
                    <!-- Will show data source information -->
                </div>
            </div>
            <button onclick="refreshVehicleStatus()" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                Refresh Status
            </button>
        </div>

        <div class="feature-card">
            <i data-lucide="wrench" class="icon"></i>
            <h3>Service & Maintenance</h3>
            <div style="text-align: left; margin-top: 1rem;">
                <div style="background: #fff3cd; padding: 1rem; margin-bottom: 1rem;">
                    <strong style="color: #856404;">Service Reminder</strong>
                    <p style="margin: 0.5rem 0; color: #856404;">Oil change due in 500 miles</p>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Next Service:</span>
                    <span style="color: var(--bmw-blue); font-weight: 600;">Jan 15, 2024</span>
                </div>
            </div>
            <button class="btn btn-outline" style="width: 100%; margin-top: 1rem;">
                Schedule Service
            </button>
        </div>

        <div class="feature-card">
            <i data-lucide="monitor" class="icon"></i>
            <h3>Remote Controls</h3>
            <div style="margin-top: 1rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                    <button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem;">
                        Unlock
                    </button>
                    <button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem;">
                        Lock
                    </button>
                    <button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem;">
                        Climate
                    </button>
                    <button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem;">
                        Locate
                    </button>
                </div>
            </div>
        </div>

        <div class="feature-card">
            <i data-lucide="bar-chart-3" class="icon"></i>
            <h3>Driving Analytics</h3>
            <div style="text-align: left; margin-top: 1rem;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>This Month:</span>
                    <span id="dashboard-monthly-miles" style="color: var(--bmw-blue); font-weight: 600;">1,245 miles</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Avg Efficiency:</span>
                    <span id="dashboard-avg-efficiency" style="color: #28a745; font-weight: 600;">3.2 mi/kWh</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Eco Score:</span>
                    <span id="dashboard-eco-score" style="color: #28a745; font-weight: 600;">92/100</span>
                </div>
            </div>
            <button onclick="window.location.href='{{ "/analytics.html" | relative_url }}'" class="btn btn-outline view-details-btn" style="width: 100%; margin-top: 1rem;">
                View Details
            </button>
        </div>

        <div class="feature-card">
            <i data-lucide="map" class="icon"></i>
            <h3>Trip Planning</h3>
            <div style="margin-top: 1rem; text-align: left;">
                <p style="margin-bottom: 1rem; color: var(--bmw-gray);">Plan your next journey with optimized routes and charging stops.</p>
                <div style="background: var(--bmw-light-gray); padding: 1rem;">
                    <strong>Recent Trip:</strong>
                    <p style="margin: 0.5rem 0; font-size: 0.9rem;">San Francisco → Los Angeles</p>
                    <p style="margin: 0; font-size: 0.8rem; color: var(--bmw-gray);">380 miles • 2 charging stops</p>
                </div>
            </div>
            <button onclick="window.location.href='{{ "/trip-planning.html" | relative_url }}'" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                Plan New Trip
            </button>
        </div>

        <div class="feature-card">
            <i data-lucide="settings" class="icon"></i>
            <h3>Settings</h3>
            <div style="margin-top: 1rem; text-align: left;">
                <div style="margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                        <input type="checkbox" checked style="margin-right: 0.5rem;">
                        <span style="font-size: 0.9rem;">Push notifications</span>
                    </label>
                    <label style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                        <input type="checkbox" checked style="margin-right: 0.5rem;">
                        <span style="font-size: 0.9rem;">Service reminders</span>
                    </label>
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" style="margin-right: 0.5rem;">
                        <span style="font-size: 0.9rem;">Location sharing</span>
                    </label>
                </div>
            </div>
            <button onclick="window.location.href='{{ "/settings.html" | relative_url }}'" class="btn btn-outline" style="width: 100%; margin-top: 1rem;">
                Manage Settings
            </button>
        </div>
    </div>

    <div class="card">
        <h2>Vehicle Connection</h2>
        <div style="margin-top: 1.5rem;">
            <div id="smartcar-status" class="smartcar-connection-status">
                <!-- Status will be updated by JavaScript -->
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Recent Activity</h2>
        <div style="margin-top: 1.5rem;">
            <div style="border-left: 4px solid var(--bmw-blue); padding-left: 1rem; margin-bottom: 1rem;">
                <strong>Vehicle locked</strong>
                <p style="margin: 0.25rem 0; color: var(--bmw-gray); font-size: 0.9rem;">Successfully locked your BMW via remote command</p>
                <small style="color: var(--bmw-gray);">2 hours ago</small>
            </div>
            
            <div style="border-left: 4px solid #28a745; padding-left: 1rem; margin-bottom: 1rem;">
                <strong>Charging completed</strong>
                <p style="margin: 0.25rem 0; color: var(--bmw-gray); font-size: 0.9rem;">Battery charged to 100% at home station</p>
                <small style="color: var(--bmw-gray);">Yesterday, 11:30 PM</small>
            </div>
            
            <div style="border-left: 4px solid #ffc107; padding-left: 1rem; margin-bottom: 1rem;">
                <strong>Service reminder</strong>
                <p style="margin: 0.25rem 0; color: var(--bmw-gray); font-size: 0.9rem;">Oil change recommended within 500 miles</p>
                <small style="color: var(--bmw-gray);">2 days ago</small>
            </div>
            
            <div style="border-left: 4px solid var(--bmw-light-blue); padding-left: 1rem;">
                <strong>Trip completed</strong>
                <p style="margin: 0.25rem 0; color: var(--bmw-gray); font-size: 0.9rem;">San Francisco to Palo Alto • 35 miles • Eco score: 94</p>
                <small style="color: var(--bmw-gray);">3 days ago</small>
            </div>
        </div>
    </div>
</div>

<div class="card auth-only">
    <h2>Access Required</h2>
    <p>The BMW Concierge dashboard contains personalized vehicle information and requires authentication to ensure your data privacy and security.</p>
    
    <div style="background: var(--bmw-light-gray); padding: 1.5rem; margin: 1.5rem 0;">
        <h3>Why do we require login?</h3>
        <ul style="margin: 1rem 0 0 1.5rem;">
            <li>Protect your personal vehicle data</li>
            <li>Ensure secure access to remote vehicle controls</li>
            <li>Personalize your experience based on your preferences</li>
            <li>Maintain session security and data integrity</li>
        </ul>
    </div>

    <div style="text-align: center;">
        <a href="{{ '/login.html' | relative_url }}" class="btn btn-primary" style="margin-right: 1rem;">
            Go to Login Page
        </a>
        <button onclick="bmwAuth.login()" class="btn btn-outline">
            Quick Login
        </button>
    </div>
</div>

<script>
// Update Smartcar connection status when page loads
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        if (window.bmwAuth) {
            updateSmartcarStatus();
        }
        if (window.vehicleAPI) {
            loadInitialVehicleData();
            updateApiModeIndicator();
        }
        if (window.analyticsManager) {
            window.analyticsManager.updateDashboardAnalytics();
        }
    }, 500);
});

// Load initial vehicle data using the new API
async function loadInitialVehicleData() {
    try {
        const result = await window.vehicleAPI.getVehicleStatus();
        if (result.success) {
            updateVehicleStatusDisplay(result.data, result.metadata);
        } else {
            console.error('Failed to load vehicle data:', result);
            showDataError('Failed to load vehicle data');
        }
    } catch (error) {
        console.error('Error loading vehicle data:', error);
        showDataError('Error loading vehicle data');
    }
}

// Update the API mode indicator
function updateApiModeIndicator() {
    const indicator = document.getElementById('api-mode-indicator');
    if (!indicator || !window.vehicleAPI) return;

    const config = window.vehicleAPI.getConfig();
    
    if (config.isDemoMode) {
        indicator.innerHTML = `
            <div style="
                background: #fff3cd; 
                border: 1px solid #ffeaa7; 
                border-radius: 4px; 
                padding: 0.5rem; 
                display: flex; 
                align-items: center; 
                gap: 0.5rem;
                font-size: 0.85rem;
            ">
                <i data-lucide="info" style="width: 16px; height: 16px; color: #856404;"></i>
                <span style="color: #856404;"><strong>Demo Mode:</strong> Displaying simulated vehicle data</span>
            </div>
        `;
    } else {
        indicator.innerHTML = `
            <div style="
                background: #d1ecf1; 
                border: 1px solid #bee5eb; 
                border-radius: 4px; 
                padding: 0.5rem; 
                display: flex; 
                align-items: center; 
                gap: 0.5rem;
                font-size: 0.85rem;
            ">
                <i data-lucide="wifi" style="width: 16px; height: 16px; color: #0c5460;"></i>
                <span style="color: #0c5460;"><strong>Live Mode:</strong> Connected to vehicle API</span>
            </div>
        `;
    }
    
    // Re-initialize BMW icons for the new content
    if (typeof bmwIcons !== 'undefined') {
        bmwIcons.createIcons();
    }
}

function updateSmartcarStatus() {
    const statusElement = document.getElementById('smartcar-status');
    if (!statusElement) return;
    
    if (bmwAuth.isSmartcarConnected()) {
        const vehicleId = bmwAuth.getSmartcarVehicleId();
        statusElement.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; color: #28a745;">
                    <i data-lucide="check-circle" style="margin-right: 0.5rem;"></i>
                    <strong>Vehicle Connected</strong>
                </div>
                <span style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                    ACTIVE
                </span>
            </div>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 0.9rem; color: var(--bmw-gray);">
                    <strong>Vehicle ID:</strong> ${vehicleId}
                </p>
                <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: var(--bmw-gray);">
                    Real-time data access enabled via Smartcar API
                </p>
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="refreshVehicleData()" class="btn btn-primary" style="flex: 1;">
                    Refresh Data
                </button>
                <button onclick="bmwAuth.disconnectSmartcar()" class="btn btn-outline" style="flex: 1;">
                    Disconnect
                </button>
            </div>
        `;
    } else {
        statusElement.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                <div style="display: flex; align-items: center; color: #6c757d;">
                    <i data-lucide="wifi-off" style="margin-right: 0.5rem;"></i>
                    <strong>Vehicle Not Connected</strong>
                </div>
                <span style="background: #6c757d; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem;">
                    OFFLINE
                </span>
            </div>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 0.9rem; color: var(--bmw-gray);">
                    Connect your vehicle through Smartcar to access real-time data and remote controls.
                </p>
                <ul style="margin: 0.5rem 0 0 1.5rem; font-size: 0.9rem; color: var(--bmw-gray);">
                    <li>Real-time battery and fuel status</li>
                    <li>Vehicle location and odometer</li>
                    <li>Remote lock/unlock and climate control</li>
                </ul>
            </div>
            <button onclick="bmwAuth.initiateSmartcarAuth()" class="btn btn-primary" style="width: 100%;">
                <i data-lucide="car" style="margin-right: 0.5rem;"></i>
                Connect Vehicle
            </button>
        `;
    }
    
    // Initialize Lucide icons for the new content
    if (typeof bmwIcons !== 'undefined') {
        bmwIcons.createIcons();
    }
}

function refreshVehicleData() {
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i data-lucide="loader" class="spinning" style="margin-right: 0.5rem;"></i>Refreshing...';
    button.disabled = true;
    
    // Simulate data refresh
    setTimeout(function() {
        button.innerHTML = originalText;
        button.disabled = false;
        
        // Show success notification
        bmwAuth.showSuccess('Vehicle data refreshed successfully');
        
        // Re-initialize icons
        if (typeof bmwIcons !== 'undefined') {
            bmwIcons.createIcons();
        }
    }, 2000);
}

async function refreshVehicleStatus() {
    // Show loading state
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i data-lucide="loader" class="spinning" style="margin-right: 0.5rem;"></i>Refreshing...';
    button.disabled = true;
    
    try {
        if (window.vehicleAPI) {
            // Use the new API system
            const result = await window.vehicleAPI.refreshVehicleStatus();
            
            if (result.success) {
                updateVehicleStatusDisplay(result.data, result.metadata);
                
                // Show appropriate notification based on demo mode
                const config = window.vehicleAPI.getConfig();
                if (config.isDemoMode) {
                    bmwAuth.showSuccess('Demo vehicle status refreshed successfully');
                } else {
                    bmwAuth.showSuccess('Vehicle status refreshed from live API');
                }
            } else {
                console.error('Failed to refresh vehicle status:', result);
                bmwAuth.showError('Failed to refresh vehicle status');
            }
        } else {
            // Fallback to old system if API not available
            bmwAuth.showError('Vehicle API not available');
        }
    } catch (error) {
        console.error('Error refreshing vehicle status:', error);
        bmwAuth.showError('Error refreshing vehicle status: ' + error.message);
    } finally {
        // Restore button state
        button.innerHTML = originalText;
        button.disabled = false;
        
        // Re-initialize icons
        if (typeof bmwIcons !== 'undefined') {
            bmwIcons.createIcons();
        }
    }
}

function updateVehicleStatusDisplay(data, metadata = {}) {
    // Update individual elements with new data
    const batteryElement = document.getElementById('battery-level');
    const fuelElement = document.getElementById('fuel-level');
    const rangeElement = document.getElementById('vehicle-range');
    const doorElement = document.getElementById('door-status');
    const statusElement = document.getElementById('vehicle-status');
    const updatedElement = document.getElementById('last-updated');
    const sourceElement = document.getElementById('data-source-info');
    
    if (batteryElement) {
        batteryElement.textContent = data.batteryLevel + '%';
        batteryElement.style.color = data.batteryLevel > 80 ? '#28a745' : data.batteryLevel > 30 ? '#ffc107' : '#dc3545';
    }
    
    if (fuelElement) {
        fuelElement.textContent = data.fuelLevel + '%';
        fuelElement.style.color = data.fuelLevel > 80 ? '#28a745' : data.fuelLevel > 30 ? '#ffc107' : '#dc3545';
    }
    
    if (rangeElement) {
        rangeElement.textContent = data.range + ' miles';
    }
    
    if (doorElement) {
        doorElement.textContent = data.doorStatus;
        doorElement.style.color = data.doorStatus === 'Locked' ? '#28a745' : '#ffc107';
    }
    
    if (statusElement) {
        statusElement.textContent = data.vehicleStatus;
        const statusColors = {
            'Secure': '#28a745',
            'Ready': '#17a2b8',
            'Parked': '#6c757d',
            'Charging': '#28a745'
        };
        statusElement.style.color = statusColors[data.vehicleStatus] || '#6c757d';
    }
    
    if (updatedElement) {
        if (data.lastUpdated) {
            const lastUpdated = new Date(data.lastUpdated);
            const now = new Date();
            const diffMinutes = Math.floor((now - lastUpdated) / (1000 * 60));
            
            if (diffMinutes < 1) {
                updatedElement.textContent = 'Just now';
            } else if (diffMinutes === 1) {
                updatedElement.textContent = '1 minute ago';
            } else if (diffMinutes < 60) {
                updatedElement.textContent = diffMinutes + ' minutes ago';
            } else {
                updatedElement.textContent = lastUpdated.toLocaleTimeString();
            }
        } else {
            updatedElement.textContent = 'Just now';
        }
    }
    
    // Update data source information
    if (sourceElement && metadata) {
        if (metadata.isDemoMode) {
            sourceElement.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.25rem;">
                    <i data-lucide="database" style="width: 12px; height: 12px;"></i>
                    <span>Source: ${metadata.dataSource || 'Demo Data'}</span>
                </div>
            `;
        } else {
            sourceElement.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.25rem;">
                    <i data-lucide="wifi" style="width: 12px; height: 12px;"></i>
                    <span>Source: Live Vehicle API</span>
                </div>
            `;
        }
        
        // Re-initialize Lucide icons for the new content
        if (typeof bmwIcons !== 'undefined') {
            bmwIcons.createIcons();
        }
    }
}

function showDataError(message) {
    const elements = ['battery-level', 'fuel-level', 'vehicle-range', 'door-status', 'vehicle-status', 'last-updated'];
    elements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = 'Error';
            element.style.color = '#dc3545';
        }
    });
    
    const sourceElement = document.getElementById('data-source-info');
    if (sourceElement) {
        sourceElement.innerHTML = `
            <div style="color: #dc3545; display: flex; align-items: center; gap: 0.25rem;">
                <i data-lucide="alert-triangle" style="width: 12px; height: 12px;"></i>
                <span>${message}</span>
            </div>
        `;
        
        if (typeof bmwIcons !== 'undefined') {
            bmwIcons.createIcons();
        }
    }
}
</script>

<style>
.smartcar-connection-status {
    /* Styles for the connection status section */
}

.spinning {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
</style>
